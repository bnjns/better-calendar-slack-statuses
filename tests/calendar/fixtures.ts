import * as ical from 'node-ical'
import { VEvent } from 'node-ical'

const getTestEvent = (ics: string): VEvent => Object
  .values(ical.parseICS(ics))
  .filter(e => e.type === 'VEVENT')[0] as VEvent

const createCalendarIcs = (event: string): string => `
BEGIN:VCALENDAR
PRODID:-//Google Inc//Google Calendar 70.9054//EN
VERSION:2.0
CALSCALE:GREGORIAN
METHOD:PUBLISH
X-WR-CALNAME:Slack Status
X-WR-TIMEZONE:Europe/London
BEGIN:VTIMEZONE
TZID:Europe/London
X-LIC-LOCATION:Europe/London
BEGIN:DAYLIGHT
TZOFFSETFROM:+0000
TZOFFSETTO:+0100
TZNAME:BST
DTSTART:19700329T010000
RRULE:FREQ=YEARLY;BYMONTH=3;BYDAY=-1SU
END:DAYLIGHT
BEGIN:STANDARD
TZOFFSETFROM:+0100
TZOFFSETTO:+0000
TZNAME:GMT
DTSTART:19701025T020000
RRULE:FREQ=YEARLY;BYMONTH=10;BYDAY=-1SU
END:STANDARD
END:VTIMEZONE
${ event }
END:VCALENDAR
`

const recurringIcs = createCalendarIcs(`
BEGIN:VEVENT
DTSTART;TZID=Europe/London:20210201T180000
DTEND;TZID=Europe/London:20210201T190000
RRULE:FREQ=WEEKLY;BYDAY=FR,MO,TH,TU,WE
DTSTAMP:20210330T172917Z
UID:0olt410vsq18ncadl7s4anar9v@google.com
CLASS:PRIVATE
CREATED:20210325T232921Z
DESCRIPTION:
LAST-MODIFIED:20210330T170727Z
LOCATION:
SEQUENCE:3
STATUS:CONFIRMED
SUMMARY:Event - recurring
TRANSP:OPAQUE
END:VEVENT
`)
export const recurring = getTestEvent(recurringIcs)

const noRecurringIcs = createCalendarIcs(`
BEGIN:VEVENT
DTSTART;TZID=Europe/London:20210201T180000
DTEND;TZID=Europe/London:20210201T190000
DTSTAMP:20210330T172917Z
UID:0olt410vsq18ncadl7s4anar9v@google.com
CLASS:PRIVATE
CREATED:20210325T232921Z
DESCRIPTION:
LAST-MODIFIED:20210330T170727Z
LOCATION:
SEQUENCE:0
STATUS:CONFIRMED
SUMMARY:Event - not recurring
TRANSP:OPAQUE
END:VEVENT
`)
export const noRecurring = getTestEvent(noRecurringIcs)
